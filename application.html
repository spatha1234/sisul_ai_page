<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIí˜‘ë ¥ì—…ì²´ ì§€ì› ì–‘ì‹ - ì„œìš¸ì‹œì„¤ê³µë‹¨</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="styles.css">
    <style>
        .application-container {
            max-width: 900px;
            margin: 120px auto 50px;
            padding: 0 2rem;
        }

        .application-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .application-header h1 {
            font-size: 2.5rem;
            color: #0082C9;
            margin-bottom: 1rem;
        }

        .application-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .form-section {
            background: white;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .form-section h2 {
            font-size: 1.5rem;
            color: #0082C9;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #0082C9;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .form-group label.required::after {
            content: ' *';
            color: #e74c3c;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0082C9;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            font-weight: normal;
            margin: 0;
            cursor: pointer;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #e9ecef;
            border-color: #0082C9;
        }

        .file-list {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        .submit-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #0082C9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 130, 201, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0082C9;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
        }

        .info-box p {
            margin: 0;
            color: #004085;
            font-size: 0.95rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .application-header h1 {
                font-size: 2rem;
            }
        }

        /* ì„±ê³µ íŒì—… ëª¨ë‹¬ */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .success-modal.show {
            display: flex;
        }

        .success-modal-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .success-modal-content h3 {
            font-size: 1.8rem;
            color: #0082C9;
            margin-bottom: 1rem;
        }

        .success-modal-content p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .success-modal-button {
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, #667eea, #0082C9);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .success-modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 130, 201, 0.3);
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header>
        <nav>
            <div class="logo">
                <a href="https://www.sisul.or.kr" target="_blank" rel="noopener noreferrer">
                    <img src="logo.png" alt="ì„œìš¸ì‹œì„¤ê³µë‹¨">
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html#overview">ëª¨ì§‘ê°œìš”</a></li>
                <li><a href="index.html#qualifications">ì§€ì›ìê²©</a></li>
                <li><a href="index.html#process">ì§€ì›ì ˆì°¨</a></li>
                <li><a href="index.html#contact">ë¬¸ì˜ì²˜</a></li>
            </ul>
        </nav>
    </header>

    <div class="application-container">
        <div class="application-header">
            <h1>AIí˜‘ë ¥ì—…ì²´ ì§€ì› ì–‘ì‹</h1>
            <p>ì„œìš¸ì‹œì„¤ê³µë‹¨ AIí˜‘ë ¥ì—…ì²´ ëª¨ì§‘ì— ì§€ì›í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</p>
        </div>

        <form id="applicationForm">
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="form-section">
                <h2>ê¸°ë³¸ ì •ë³´</h2>
                <div class="info-box">
                    <p>ëª¨ë“  í•„ìˆ˜ í•­ëª©(*)ì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                </div>

                <div class="form-group">
                    <label class="required">íšŒì‚¬ëª…</label>
                    <input type="text" name="companyName" required placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">ëŒ€í‘œìëª…</label>
                        <input type="text" name="representative" required placeholder="ëŒ€í‘œìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label class="required">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" name="businessNumber" required placeholder="000-00-00000" pattern="[0-9]{3}-[0-9]{2}-[0-9]{5}">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">ë‹´ë‹¹ìëª…</label>
                        <input type="text" name="contactPerson" required placeholder="ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label class="required">ë‹´ë‹¹ì ì§ì±…</label>
                        <input type="text" name="position" required placeholder="ì˜ˆ: ëŒ€í‘œì´ì‚¬, ìƒë¬´ ë“±">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" name="phone" required placeholder="02-0000-0000" pattern="[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}">
                    </div>
                    <div class="form-group">
                        <label class="required">ì´ë©”ì¼</label>
                        <input type="email" name="email" required placeholder="example@company.com">
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">íšŒì‚¬ ì£¼ì†Œ</label>
                    <input type="text" name="address" required placeholder="íšŒì‚¬ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label>íšŒì‚¬ í™ˆí˜ì´ì§€</label>
                    <input type="text" name="website" placeholder="https://www.example.com">
                </div>
            </div>

            <!-- í˜‘ë ¥ ë¶„ì•¼ -->
            <div class="form-section">
                <h2>í˜‘ë ¥ ë¶„ì•¼</h2>
                <div class="form-group">
                    <label class="required">ì£¼ìš” í˜‘ë ¥ ë¶„ì•¼</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="ai-facility" id="field1">
                            <label for="field1">AI ê¸°ë°˜ ì‹œì„¤ ê´€ë¦¬</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="smart-city" id="field2">
                            <label for="field2">ìŠ¤ë§ˆíŠ¸ ì‹œí‹° ì†”ë£¨ì…˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="data-analysis" id="field3">
                            <label for="field3">ë°ì´í„° ë¶„ì„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="predictive-maintenance" id="field4">
                            <label for="field4">ì˜ˆì¸¡ ìœ ì§€ë³´ìˆ˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="automation" id="field5">
                            <label for="field5">ìë™í™” ì‹œìŠ¤í…œ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="cooperationField" value="other" id="field6">
                            <label for="field6">ê¸°íƒ€</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>ê¸°íƒ€ í˜‘ë ¥ ë¶„ì•¼ ìƒì„¸</label>
                    <textarea name="cooperationDetail" placeholder="ê¸°íƒ€ í˜‘ë ¥ ë¶„ì•¼ê°€ ìˆìœ¼ì‹œë©´ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
                </div>
            </div>

            <!-- íšŒì‚¬ ì†Œê°œ -->
            <div class="form-section">
                <h2>íšŒì‚¬ ì†Œê°œ</h2>
                <div class="form-group">
                    <label class="required">íšŒì‚¬ ê°œìš”</label>
                    <textarea name="companyOverview" required placeholder="íšŒì‚¬ì˜ ì„¤ë¦½ ëª©ì , ì£¼ìš” ì‚¬ì—… ë¶„ì•¼, ë¹„ì „ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label class="required">ì£¼ìš” ê¸°ìˆ  ë° ì„œë¹„ìŠ¤</label>
                    <textarea name="technology" required placeholder="ë³´ìœ í•˜ê³  ìˆëŠ” AI ê¸°ìˆ , ì„œë¹„ìŠ¤, ì†”ë£¨ì…˜ ë“±ì„ ìƒì„¸íˆ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label class="required">ì£¼ìš” ì‹¤ì </label>
                    <textarea name="achievements" required placeholder="ê³¼ê±° ìˆ˜í–‰í•œ í”„ë¡œì íŠ¸, ì£¼ìš” ê³ ê°ì‚¬, ì„±ê³¼ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label>íŠ¹í—ˆ ë° ì§€ì ì¬ì‚°ê¶Œ</label>
                    <textarea name="patents" placeholder="ë³´ìœ í•œ íŠ¹í—ˆ, ì €ì‘ê¶Œ, ìƒí‘œê¶Œ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label>ì¸ì¦ ë° í’ˆì§ˆ ê´€ë¦¬</label>
                    <textarea name="certifications" placeholder="ë³´ìœ í•œ ì¸ì¦ì„œ, í’ˆì§ˆ ê´€ë¦¬ ì²´ê³„ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </div>

            <!-- ì²¨ë¶€ íŒŒì¼ -->
            <div class="form-section">
                <h2>ì²¨ë¶€ íŒŒì¼</h2>
                <div class="info-box">
                    <p>íŒŒì¼ì€ ê°ê° 10MB ì´í•˜ë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. (ì§€ì› í˜•ì‹: PDF, DOC, DOCX, JPG, PNG)</p>
                </div>

                <div class="form-group">
                    <label class="required">ì‚¬ì—…ìë“±ë¡ì¦</label>
                    <div class="file-upload">
                        <input type="file" name="businessLicense" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" required>
                        <label for="businessLicense" class="file-upload-label">
                            ğŸ“ íŒŒì¼ ì„ íƒ (í•„ìˆ˜)
                        </label>
                    </div>
                    <div class="file-list" id="fileList1"></div>
                </div>

                <div class="form-group">
                    <label class="required">íšŒì‚¬ì†Œê°œì„œ</label>
                    <div class="file-upload">
                        <input type="file" name="companyProfile" accept=".pdf,.doc,.docx" required>
                        <label for="companyProfile" class="file-upload-label">
                            ğŸ“ íŒŒì¼ ì„ íƒ (í•„ìˆ˜)
                        </label>
                    </div>
                    <div class="file-list" id="fileList2"></div>
                </div>

                <div class="form-group">
                    <label>ê¸°ìˆ ë³´ìœ  ì¦ë¹™ìë£Œ</label>
                    <div class="file-upload">
                        <input type="file" name="technologyProof" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        <label for="technologyProof" class="file-upload-label">
                            ğŸ“ íŒŒì¼ ì„ íƒ (ì„ íƒ)
                        </label>
                    </div>
                    <div class="file-list" id="fileList3"></div>
                </div>

                <div class="form-group">
                    <label>ê¸°íƒ€ ì²¨ë¶€ ìë£Œ</label>
                    <div class="file-upload">
                        <input type="file" name="otherFiles" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple>
                        <label for="otherFiles" class="file-upload-label">
                            ğŸ“ íŒŒì¼ ì„ íƒ (ì„ íƒ, ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)
                        </label>
                    </div>
                    <div class="file-list" id="fileList4"></div>
                </div>
            </div>

            <!-- ì œì¶œ ë²„íŠ¼ -->
            <div class="submit-buttons">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='index.html'">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì§€ì›ì„œ ì œì¶œ</button>
            </div>
        </form>
    </div>

    <!-- ì„±ê³µ íŒì—… ëª¨ë‹¬ -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <div class="success-icon">âœ…</div>
            <h3>ì œì¶œ ì™„ë£Œ!</h3>
            <p>ì§€ì›ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ê²€í†  í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
            <button class="success-modal-button" onclick="closeSuccessModal()">í™•ì¸</button>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer>
        <p>&copy; 2026 ì„œìš¸ì‹œì„¤ê³µë‹¨. All rights reserved.</p>
        <p>ì„œìš¸ì‹œì„¤ê³µë‹¨ê³¼ í•¨ê»˜ ë” ë‚˜ì€ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
    </footer>

    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
            const SUPABASE_URL = 'https://rqewmdskqkqvczjwznwm.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJxZXdtZHNrcWtxdmN6and6bndtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MDgwNDIsImV4cCI6MjA4NDk4NDA0Mn0.ot8b0gU9eBNE6bAKwRIs9cL-ngAqXTZ5Xo0Pe1a_iCE';
            
            if (typeof window.supabase === 'undefined') {
                console.error('Supabase í´ë¼ì´ì–¸íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                alert('Supabase í´ë¼ì´ì–¸íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            const STORAGE_BUCKET = 'applications'; // Storage ë²„í‚· ì´ë¦„

            // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì„¤ì •)
            window.showSuccessModal = function() {
                const modal = document.getElementById('successModal');
                if (modal) {
                    modal.classList.add('show');
                }
            };

            // ì„±ê³µ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì„¤ì •)
            window.closeSuccessModal = function() {
                const modal = document.getElementById('successModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            };

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            const successModal = document.getElementById('successModal');
            if (successModal) {
                successModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        window.closeSuccessModal();
                    }
                });
            }

        // íŒŒì¼ ì„ íƒ ì‹œ íŒŒì¼ëª… í‘œì‹œ
        document.querySelectorAll('input[type="file"]').forEach((input, index) => {
            input.addEventListener('change', function(e) {
                const fileList = document.getElementById(`fileList${index + 1}`);
                if (this.files && this.files.length > 0) {
                    let fileNames = [];
                    for (let i = 0; i < this.files.length; i++) {
                        const fileSize = (this.files[i].size / 1024 / 1024).toFixed(2);
                        fileNames.push(`${this.files[i].name} (${fileSize}MB)`);
                    }
                    fileList.innerHTML = fileNames.join('<br>');
                } else {
                    fileList.innerHTML = '';
                }
            });
        });

        // íŒŒì¼ì„ Supabase Storageì— ì—…ë¡œë“œ
        async function uploadFile(file, applicationId, fileType) {
            const fileExt = file.name.split('.').pop();
            const fileName = `${applicationId}/${fileType}_${Date.now()}.${fileExt}`;
            const filePath = `${fileName}`;

            const { data, error } = await supabase.storage
                .from(STORAGE_BUCKET)
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: false
                });

            if (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            }

            // íŒŒì¼ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
            const { data: fileData, error: dbError } = await supabase
                .from('application_files')
                .insert({
                    application_id: applicationId,
                    file_type: fileType,
                    file_name: file.name,
                    file_path: filePath,
                    file_size: file.size,
                    mime_type: file.type
                });

            if (dbError) {
                console.error('íŒŒì¼ ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', dbError);
                throw dbError;
            }

            return filePath;
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        const form = document.getElementById('applicationForm');
        if (!form) {
            console.error('í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // í˜‘ë ¥ ë¶„ì•¼ ì²´í¬ í™•ì¸
            const cooperationFields = document.querySelectorAll('input[name="cooperationField"]:checked');
            if (cooperationFields.length === 0) {
                alert('ì£¼ìš” í˜‘ë ¥ ë¶„ì•¼ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // íŒŒì¼ í¬ê¸° í™•ì¸
            const fileInputs = document.querySelectorAll('input[type="file"]');
            let hasError = false;
            fileInputs.forEach(input => {
                if (input.files && input.files.length > 0) {
                    for (let i = 0; i < input.files.length; i++) {
                        const fileSize = input.files[i].size / 1024 / 1024; // MB
                        if (fileSize > 10) {
                            alert(`${input.files[i].name} íŒŒì¼ì´ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                            hasError = true;
                        }
                    }
                }
            });

            if (hasError) return;

            // ì œì¶œ í™•ì¸
            if (!confirm('ì§€ì›ì„œë¥¼ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì œì¶œ í›„ì—ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.')) {
                return;
            }

            // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'ì œì¶œ ì¤‘...';

            try {
                // í¼ ë°ì´í„° ìˆ˜ì§‘
                const formData = new FormData(this);
                const cooperationFieldValues = Array.from(cooperationFields).map(field => field.value);

                // ì§€ì›ì„œ ë°ì´í„° ì¤€ë¹„
                const applicationData = {
                    company_name: formData.get('companyName'),
                    representative: formData.get('representative'),
                    business_number: formData.get('businessNumber'),
                    contact_person: formData.get('contactPerson'),
                    position: formData.get('position'),
                    phone: formData.get('phone'),
                    email: formData.get('email'),
                    address: formData.get('address'),
                    website: formData.get('website') || null,
                    cooperation_fields: cooperationFieldValues,
                    cooperation_detail: formData.get('cooperationDetail') || null,
                    company_overview: formData.get('companyOverview'),
                    technology: formData.get('technology'),
                    achievements: formData.get('achievements'),
                    patents: formData.get('patents') || null,
                    certifications: formData.get('certifications') || null
                };

                // 1. ì§€ì›ì„œ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
                const { data: application, error: appError } = await supabase
                    .from('applications')
                    .insert(applicationData)
                    .select()
                    .single();

                if (appError) {
                    console.error('ì§€ì›ì„œ ì €ì¥ ì˜¤ë¥˜:', appError);
                    throw new Error('ì§€ì›ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + appError.message);
                }

                const applicationId = application.id;

                // 2. íŒŒì¼ ì—…ë¡œë“œ
                const fileUploadPromises = [];

                // ì‚¬ì—…ìë“±ë¡ì¦
                const businessLicense = formData.get('businessLicense');
                if (businessLicense && businessLicense.size > 0) {
                    fileUploadPromises.push(uploadFile(businessLicense, applicationId, 'businessLicense'));
                }

                // íšŒì‚¬ì†Œê°œì„œ
                const companyProfile = formData.get('companyProfile');
                if (companyProfile && companyProfile.size > 0) {
                    fileUploadPromises.push(uploadFile(companyProfile, applicationId, 'companyProfile'));
                }

                // ê¸°ìˆ ë³´ìœ  ì¦ë¹™ìë£Œ
                const technologyProof = formData.get('technologyProof');
                if (technologyProof && technologyProof.size > 0) {
                    fileUploadPromises.push(uploadFile(technologyProof, applicationId, 'technologyProof'));
                }

                // ê¸°íƒ€ ì²¨ë¶€ ìë£Œ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)
                const otherFiles = formData.getAll('otherFiles');
                otherFiles.forEach(file => {
                    if (file && file.size > 0) {
                        fileUploadPromises.push(uploadFile(file, applicationId, 'otherFiles'));
                    }
                });

                // ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ëŒ€ê¸°
                await Promise.all(fileUploadPromises);

                // í¼ ë¦¬ì…‹
                this.reset();
                document.querySelectorAll('.file-list').forEach(el => el.innerHTML = '');

                // ì„±ê³µ íŒì—… í‘œì‹œ
                window.showSuccessModal();

            } catch (error) {
                console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                alert('ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '\n\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                // ì œì¶œ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            }
        });
        }); // DOMContentLoaded ì¢…ë£Œ
    </script>
</body>
</html>
